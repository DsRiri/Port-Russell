<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css">
</head>
<body>
    <%- include('../partials/header') %>
    <%- include('../partials/navbar') %>
    
    <main class="container doc-container">
        <h1>Documentation de l'API Port Russell</h1>
        
        <div class="doc-toc">
            <h3>Sommaire</h3>
            <ul>
                <li><a href="#overview">üìã Vue d'ensemble</a></li>
                <li><a href="#auth">üîê Authentification</a></li>
                <li><a href="#catways">üö§ Catways</a></li>
                <li><a href="#reservations">üìÖ R√©servations</a></li>
                <li><a href="#users">üë§ Utilisateurs</a></li>
                <li><a href="#tutorial">üìö Tutoriel</a></li>
                <li><a href="#examples">üí° Exemples</a></li>
                <li><a href="#glossary">üìñ Glossaire</a></li>
            </ul>
        </div>

        <section id="overview" class="doc-section">
            <h2>üìã Vue d'ensemble</h2>
            <p>API priv√©e pour la gestion des catways et r√©servations du Port de Plaisance Russell.</p>
            
            <div class="doc-info-box">
                <h4>Informations g√©n√©rales</h4>
                <ul>
                    <li><strong>Base URL:</strong> <code>http://localhost:3000/api</code></li>
                    <li><strong>Format des r√©ponses:</strong> JSON</li>
                    <li><strong>Authentification:</strong> JWT (Bearer token)</li>
                    <li><strong>Documentation:</strong> <code>/documentation</code></li>
                </ul>
            </div>

            <h4>Codes de statut HTTP</h4>
            <table class="doc-table">
                <tr><th>Code</th><th>Description</th></tr>
                <tr><td>200</td><td>Succ√®s</td></tr>
                <tr><td>201</td><td>Cr√©√© avec succ√®s</td></tr>
                <tr><td>400</td><td>Erreur de validation</td></tr>
                <tr><td>401</td><td>Non authentifi√©</td></tr>
                <tr><td>403</td><td>Non autoris√©</td></tr>
                <tr><td>404</td><td>Ressource non trouv√©e</td></tr>
                <tr><td>500</td><td>Erreur serveur</td></tr>
            </table>
        </section>

        <section id="auth" class="doc-section">
            <h2>üîê Authentification</h2>
            
            <h3>POST /login</h3>
            <p>Connexion utilisateur et obtention du token JWT</p>
            
            <h4>Body (x-www-form-urlencoded ou JSON)</h4>
            <pre><code class="language-json">{
    "email": "capitainerie@port-russell.fr",
    "password": "PortRussell2026"
}</code></pre>

            <h4>R√©ponse (succ√®s)</h4>
            <pre><code class="language-json">{
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "user": {
        "id": "65a1b2c3d4e5f67890123456",
        "name": "Capitainerie",
        "email": "capitainerie@port-russell.fr"
    }
}</code></pre>

            <h4>R√©ponse (erreur)</h4>
            <pre><code class="language-json">{
    "success": false,
    "error": "Email ou mot de passe incorrect"
}</code></pre>

            <h3>GET /logout</h3>
            <p>D√©connexion (d√©truit la session)</p>
        </section>

        <section id="catways" class="doc-section">
            <h2>üö§ Catways</h2>
            <p class="doc-note">Toutes les routes sont prot√©g√©es : n√©cessitent le token JWT dans le header <code>Authorization: Bearer &lt;token&gt;</code></p>

            <table class="doc-table">
                <tr>
                    <th>M√©thode</th>
                    <th>Route</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><span class="method-get">GET</span></td>
                    <td><code>/catways</code></td>
                    <td>Lister tous les catways</td>
                </tr>
                <tr>
                    <td><span class="method-get">GET</span></td>
                    <td><code>/catways/:id</code></td>
                    <td>R√©cup√©rer les d√©tails d'un catway</td>
                </tr>
                <tr>
                    <td><span class="method-post">POST</span></td>
                    <td><code>/catways</code></td>
                    <td>Cr√©er un nouveau catway</td>
                </tr>
                <tr>
                    <td><span class="method-put">PUT</span></td>
                    <td><code>/catways/:id</code></td>
                    <td>Remplacer compl√®tement un catway</td>
                </tr>
                <tr>
                    <td><span class="method-patch">PATCH</span></td>
                    <td><code>/catways/:id</code></td>
                    <td>Modifier partiellement un catway</td>
                </tr>
                <tr>
                    <td><span class="method-delete">DELETE</span></td>
                    <td><code>/catways/:id</code></td>
                    <td>Supprimer un catway</td>
                </tr>
            </table>

            <h4>Mod√®le Catway</h4>
            <pre><code class="language-json">{
    "_id": "65a1b2c3d4e5f67890123456",
    "catwayNumber": 5,
    "type": "long",
    "catwayState": "Bon √©tat, peinture r√©cente",
    "createdAt": "2026-02-24T10:00:00Z",
    "updatedAt": "2026-02-24T10:00:00Z"
}</code></pre>

            <h4>Cr√©ation d'un catway (POST)</h4>
            <pre><code class="language-json">{
    "catwayNumber": 10,
    "type": "short",
    "catwayState": "Neuf, installation 2026"
}</code></pre>
        </section>

        <section id="reservations" class="doc-section">
            <h2>üìÖ R√©servations</h2>
            <p class="doc-note">Les r√©servations sont des sous-ressources des catways</p>

            <table class="doc-table">
                <tr>
                    <th>M√©thode</th>
                    <th>Route</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><span class="method-get">GET</span></td>
                    <td><code>/catways/:id/reservations</code></td>
                    <td>Lister les r√©servations d'un catway</td>
                </tr>
                <tr>
                    <td><span class="method-get">GET</span></td>
                    <td><code>/catways/:id/reservations/:idReservation</code></td>
                    <td>D√©tails d'une r√©servation sp√©cifique</td>
                </tr>
                <tr>
                    <td><span class="method-post">POST</span></td>
                    <td><code>/catways/:id/reservations</code></td>
                    <td>Cr√©er une r√©servation</td>
                </tr>
                <tr>
                    <td><span class="method-delete">DELETE</span></td>
                    <td><code>/catways/:id/reservations/:idReservation</code></td>
                    <td>Supprimer une r√©servation</td>
                </tr>
            </table>

            <h4>Mod√®le R√©servation</h4>
            <pre><code class="language-json">{
    "_id": "65a1b2c3d4e5f67890123457",
    "catwayNumber": 5,
    "clientName": "Jean Dupont",
    "boatName": "Sea Breeze",
    "checkIn": "2026-03-15T10:00:00Z",
    "checkOut": "2026-03-22T10:00:00Z",
    "createdAt": "2026-02-24T10:00:00Z",
    "updatedAt": "2026-02-24T10:00:00Z"
}</code></pre>
        </section>

        <section id="users" class="doc-section">
            <h2>üë§ Utilisateurs</h2>

            <table class="doc-table">
                <tr>
                    <th>M√©thode</th>
                    <th>Route</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><span class="method-get">GET</span></td>
                    <td><code>/users</code></td>
                    <td>Lister tous les utilisateurs</td>
                </tr>
                <tr>
                    <td><span class="method-get">GET</span></td>
                    <td><code>/users/:id</code></td>
                    <td>D√©tails d'un utilisateur</td>
                </tr>
                <tr>
                    <td><span class="method-post">POST</span></td>
                    <td><code>/users</code></td>
                    <td>Cr√©er un utilisateur</td>
                </tr>
                <tr>
                    <td><span class="method-put">PUT</span></td>
                    <td><code>/users/:id</code></td>
                    <td>Modifier un utilisateur</td>
                </tr>
                <tr>
                    <td><span class="method-delete">DELETE</span></td>
                    <td><code>/users/:id</code></td>
                    <td>Supprimer un utilisateur</td>
                </tr>
            </table>
        </section>

        <section id="tutorial" class="doc-section">
            <h2>üìö Tutoriel pas √† pas</h2>

            <h3>1. Connexion</h3>
            <pre><code class="language-bash">curl -X POST http://localhost:3000/login \
  -H "Content-Type: application/json" \
  -d '{"email":"capitainerie@port-russell.fr","password":"PortRussell2026"}'</code></pre>

            <h3>2. R√©cup√©rer le token</h3>
            <p>La r√©ponse contient le token JWT √† utiliser pour les requ√™tes suivantes.</p>

            <h3>3. Cr√©er un catway</h3>
            <pre><code class="language-bash">curl -X POST http://localhost:3000/api/catways \
  -H "Authorization: Bearer VOTRE_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"catwayNumber":10,"type":"long","catwayState":"Neuf"}'</code></pre>

            <h3>4. Cr√©er une r√©servation</h3>
            <pre><code class="language-bash">curl -X POST http://localhost:3000/api/catways/ID_CATWAY/reservations \
  -H "Authorization: Bearer VOTRE_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"clientName":"Jean Dupont","boatName":"Sea Breeze","checkIn":"2026-05-01T10:00:00Z","checkOut":"2026-05-08T10:00:00Z"}'</code></pre>

            <h3>5. Utiliser le dashboard</h3>
            <p>Connectez-vous sur <a href="/login">/login</a> pour acc√©der au tableau de bord avec tous les formulaires.</p>
        </section>

        <section id="examples" class="doc-section">
            <h2>üí° Exemples d'utilisation</h2>

            <h3>Avec JavaScript (fetch)</h3>
            <pre><code class="language-javascript">// Connexion
const login = async () => {
    const res = await fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            email: 'capitainerie@port-russell.fr',
            password: 'PortRussell2026'
        })
    });
    const data = await res.json();
    localStorage.setItem('token', data.token);
};

// Cr√©er un catway
const createCatway = async () => {
    const token = localStorage.getItem('token');
    const res = await fetch('/api/catways', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            catwayNumber: 15,
            type: 'short',
            catwayState: 'Bon √©tat'
        })
    });
    return await res.json();
};</code></pre>

            <h3>Avec Postman</h3>
            <ol>
                <li>Cr√©ez une requ√™te POST vers <code>http://localhost:3000/login</code></li>
                <li>Body ‚Üí raw ‚Üí JSON avec email/password</li>
                <li>Copiez le token de la r√©ponse</li>
                <li>Pour chaque requ√™te API, ajoutez le header:
                    <code>Authorization: Bearer &lt;token&gt;</code>
                </li>
            </ol>
        </section>

        <section id="glossary" class="doc-section">
            <h2>üìñ Glossaire</h2>

            <dl class="glossary">
                <dt>Catway</dt>
                <dd>Petit appontement pour amarrer un bateau. Peut √™tre de type "long" ou "short".</dd>

                <dt>R√©servation</dt>
                <dd>P√©riode durant laquelle un bateau occupe un catway sp√©cifique.</dd>

                <dt>JWT (JSON Web Token)</dt>
                <dd>Jeton d'authentification permettant d'acc√©der aux routes prot√©g√©es.</dd>

                <dt>CheckIn / CheckOut</dt>
                <dd>Dates de d√©but et fin de r√©servation au format ISO (ex: 2026-03-15T10:00:00Z).</dd>

                <dt>Middleware</dt>
                <dd>Fonction qui s'ex√©cute avant les routes pour v√©rifier l'authentification.</dd>

                <dt>CRUD</dt>
                <dd>Create, Read, Update, Delete - Les 4 op√©rations de base.</dd>
            </dl>
        </section>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
    
    <%- include('../partials/footer') %>
</body>
</html>